on:
  workflow_call:
    inputs:
      tag_prefix:
        type: string
        default: ""
        description: "Prefix to prepend to the tag"
      tag_suffix:
        type: string
        default: ""
        description: "Suffix to append to the tag, useful for RC releases, etc"
    secrets:
      custom_github_token:
        required: false
        description: "Token for the repo, useful when tag release event needs to trigger another workflow in the same repo"
    outputs:
      version:
        description: The version string generated by action
        value: ${{ jobs.release_tag.outputs.version }}
      version_tag:
        description: String identifier that would be used to tag the current commit as the "released" version. Typically this would only be used to generate a Git tag name
        value: ${{ jobs.release_tag.outputs.version_tag }}

env:
  TAG_SUFFIX_DELIMITER: ${{ inputs.tag_suffix && '-' || ''}}

jobs:
  release_tag:
    name: release a tag
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.semver.outputs.version }}
      version_tag: ${{ steps.semver.outputs.version_tag }}
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Bump semver
        id: semver
        uses: paulhatch/semantic-version@v5.4.0
        with:
          tag_prefix: ${{ inputs.tag_prefix }}
          namespace: ${{ inputs.tag_suffix }}
      - name: Create and push semver tag
        uses: anothrNick/github-tag-action@1.73.0
        env:
          GITHUB_TOKEN: ${{ secrets.custom_github_token || secrets.GITHUB_TOKEN }}
          CUSTOM_TAG: ${{ steps.semver.outputs.version_tag }}
